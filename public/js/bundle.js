webpackJsonp([0],[function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r,s,h=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function(){function e(t){var i=this;o(this,e),this.handler=new WebSocket(config.WSS),this.id=t.id,this.openid=t.openid,this.headimg=t.headimg,this.nickname=t.nickname,this.handler.onopen=function(){console.log("连接已打开"),i.handler.send(JSON.stringify({id:t.id,type:"join",openid:t.openid,headimg:t.headimg,nickname:t.nickname}))},this.handler.onclose=function(){i.handler=null},this.handler.onmessage=function(e){t.onMessage(e)}}return h(e,[{key:"send",value:function(e){this.handler&&this.handler.send(JSON.stringify({id:this.id,type:"operate",pos:e,openid:this.openid,headimg:this.headimg,nickname:this.nickname}))}}]),e}(),l=function(e){function t(e,i,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;o(this,t);var h=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),c=e.rnd.between(1,4);return Phaser.Sprite.call(h,e,i,a,c),h.width=r,h.height=s,h.inputEnabled=!1,e.physics.arcade.enable(h),h.body.collideWorldBounds=!0,h.body.immovable=!0,h}return a(t,e),t}(Phaser.Sprite),d=function(e){function t(e,i,a,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:25,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:25;o(this,t);var c=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Phaser.Sprite.call(c,e,i,a,r),c.width=s,c.height=h,e.physics.arcade.enable(c),c.smoothed=!0,c.body.collideWorldBounds=!0,e.world.add(c),c}return a(t,e),t}(Phaser.Sprite),g=function(e){function t(e,i,a,r,s){var h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:70,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:70,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:110,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:110;arguments.length>9&&void 0!==arguments[9]&&arguments[9];o(this,t);var g=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Phaser.Button.call(g,e,i,a,r,null,g),g.width=h,g.anchor.setTo(.5,.5),g.fixedToCamera=!0,g.height=c,g.smoothed=!0,g.visible=!0,e.world.add(g),g.child=new Phaser.Button(e,0,0,s),g.child.width=l,g.child.height=d,g.child.anchor.setTo(.5,.5),g.child.smoothed=!0,g.child.visible=!0,g.addChild(g.child),g}return a(t,e),h(t,[{key:"move",value:function(e,t){var i=this.worldPosition.x,n=this.worldPosition.y,a=Phaser.Math.angleBetweenY(i,n,e,t),o=this.child.width*Math.sin(a),r=this.child.width*Math.cos(a);this.child.position.x=o,this.child.position.y=r}},{key:"tap",value:function(e,t){this.fixedToCamera=!1,this.position.x=e,this.position.y=t,this.child.position.x=0,this.child.position.y=0,this.child.visible=!0,this.fixedToCamera=!0}},{key:"cancel",value:function(){this.child.visible=!1}}]),t}(Phaser.Button),u=[],p={},m={},f=null;!function(){function e(t,i,n){var a=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"所谓伊人";o(this,e),this.game=new Phaser.Game("100","100",Phaser.CANVAS,"container"),this.game.state.add("preload",this.preload),this.game.state.add("create",this.create),this.game.state.add("play",this.play),this.game.state.add("over",this.over),f=new c({id:t,openid:i,headimg:n,nickname:r,onMessage:function(e){a.receive(e)}}),this.game.state.start("preload")}h(e,[{key:"preload",value:function(){var e=this;this.preload=function(){e.game.load.crossOrigin="anonymous",e.game.stage.backgroundColor="#ffffff",e.game.load.image("1","./img/tree1.png"),e.game.load.image("2","./img/tree2.png"),e.game.load.image("3","./img/tree3.png"),e.game.load.image("4","./img/flower.png"),e.game.load.image("c1","./img/c1.png"),e.game.load.image("c2","./img/c2.png"),e.game.load.image("p1",p.img),e.game.load.image("p2",m.img)},this.create=function(){e.game.state.start("create")}}},{key:"create",value:function(){var e=this;this.create=function(){e.game.world.setBounds(0,0,1640,1230),e.game.physics.startSystem(Phaser.Physics.ARCADE),e.game.state.start("play")}}},{key:"play",value:function(){var e,t,i,n=this;this.create=function(){e=n.game.add.group(),e.ignoreChildInput=!0;for(var a in u)for(var o in u[a])0===u[a][o]&&e.add(new l(n.game,40*a,40*o));r=new d(n.game,40*p.x+7,40*p.y+7,"p1"),s=new d(n.game,40*m.x+7,40*m.y+7,"p2");var h={},c=!1;i=new g(n.game,60,60,"c1","c2"),n.game.camera.follow(r),n.game.input.maxPointers=1,n.game.input.onDown.add(function(e,t){c=!0,Object.assign(h,{x:e.clientX,y:e.clientY}),i.tap(e.clientX,e.clientY)}),n.game.input.onUp.add(function(e,t){c=!1,h={},r.body.velocity.x=0,r.body.velocity.y=0,i.cancel()}),n.game.input.addMoveCallback(function(e,t,n,a){if(this.game.debug.pointer(this.game.input.pointer1),!a&&c){var o=t-h.x,s=n-h.y;Math.abs(o)>Math.abs(s)?t>h.x?r.body.velocity.x=300:r.body.velocity.x=-300:n>h.y?r.body.velocity.y=300:r.body.velocity.y=-300,i.move(t,n)}},n.game.input.pointer1),t=setInterval(function(){c&&f.send({x:n.game.world.width-r.position.x-r.width,y:n.game.world.height-r.position.y-r.height})},100)},this.update=function(){n.game.physics.arcade.collide(r,e),n.game.physics.arcade.overlap(r,s,function(){clearInterval(t),this.game.state.start("over",!0,!1)},null,n)}}},{key:"render",value:function(e,t){this.game.add.tween(s).to({x:e,y:t},50,Phaser.Easing.Linear.None,!0,0,0)}},{key:"over",value:function(){this.create=function(){}}},{key:"receive",value:function(e){var t=JSON.parse(e.data);switch(t.code){case-1:break;case 1:console.log(t.user.nickname+"加入了游戏");break;case 0:this.render(t.operation.pos.x,t.operation.pos.y),console.log(t.operation.nickname+"移動至x:"+t.operation.pos.x+",y:"+t.operation.pos.y);break;case 200:u=t.maze,p=t.location,m=t.other,this.game.state.start("preload");break;case 403:console.log(t.msg)}}}])}()}],[0]);