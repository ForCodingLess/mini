webpackJsonp([0],[function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(){var e,t,i=function(){function e(t){var i=this;o(this,e),this.handler=new WebSocket(config.WSS),this.id=t.id,this.openid=t.openid,this.headimg=t.headimg,this.nickname=t.nickname,this.handler.onopen=function(){console.log("连接已打开"),i.handler.send(JSON.stringify({id:t.id,type:"join",openid:t.openid,headimg:t.headimg,nickname:t.nickname}))},this.handler.onclose=function(){i.handler=null},this.handler.onmessage=function(e){t.onMessage(e)}}return r(e,[{key:"send",value:function(e){this.handler&&this.handler.send(JSON.stringify({id:this.id,type:"operate",pos:e,openid:this.openid,headimg:this.headimg,nickname:this.nickname}))}}]),e}(),s=function(e){function t(e,i,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;o(this,t);var c=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),h=e.rnd.between(1,4);return Phaser.Sprite.call(c,e,i,a,h),c.width=r,c.height=s,c.inputEnabled=!1,e.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.body.immovable=!0,c}return a(t,e),t}(Phaser.Sprite),c=function(e){function t(e,i,a,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:25,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:25;o(this,t);var h=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Phaser.Sprite.call(h,e,i,a,r),h.width=s,h.height=c,e.physics.arcade.enable(h),h.smoothed=!0,h.body.collideWorldBounds=!0,e.world.add(h),h}return a(t,e),t}(Phaser.Sprite),h=function(e){function t(e,i,a,r,s){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:70,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:70,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:110,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:110;arguments.length>9&&void 0!==arguments[9]&&arguments[9];o(this,t);var g=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Phaser.Button.call(g,e,i,a,r,null,g),g.width=c,g.anchor.setTo(.5,.5),g.fixedToCamera=!0,g.height=h,g.smoothed=!0,g.visible=!0,e.world.add(g),g.child=new Phaser.Button(e,0,0,s),g.child.width=l,g.child.height=d,g.child.anchor.setTo(.5,.5),g.child.smoothed=!0,g.child.visible=!0,g.addChild(g.child),g}return a(t,e),r(t,[{key:"move",value:function(e,t){var i=this.worldPosition.x,n=this.worldPosition.y,a=Phaser.Math.angleBetweenY(i,n,e,t),o=this.child.width*Math.sin(a),r=this.child.width*Math.cos(a);this.child.position.x=o,this.child.position.y=r}},{key:"tap",value:function(e,t){this.fixedToCamera=!1,this.position.x=e,this.position.y=t,this.child.position.x=0,this.child.position.y=0,this.child.visible=!0,this.fixedToCamera=!0}},{key:"cancel",value:function(){this.child.visible=!1}}]),t}(Phaser.Button),l=[],d={},g={},p=null,u=function(){function n(){var e=this;o(this,n),this.game=new Phaser.Game("100","100",Phaser.CANVAS,"container"),this.game.state.add("preload",this.preload),this.game.state.add("create",this.create),this.game.state.add("play",this.play),this.game.state.add("over",this.over);var t=~~(1e4*Math.random()).toString();p=new i({id:"123123",openid:t,headimg:"https://shp.qpic.cn/bizmp/CQ3lYf0saco7sJYbFrn3jvMxDJHjqZqiaqtGMtMNSqnW6DwcRD6qwGA/",nickname:"eee",onMessage:function(t){e.receive(t)}}),this.game.state.start("preload")}return r(n,[{key:"preload",value:function(){var e=this;this.preload=function(){e.game.load.crossOrigin="anonymous",e.game.stage.backgroundColor="#ffffff",e.game.load.image("1","./img/tree1.png"),e.game.load.image("2","./img/tree2.png"),e.game.load.image("3","./img/tree3.png"),e.game.load.image("4","./img/flower.png"),e.game.load.image("c1","./img/c1.png"),e.game.load.image("c2","./img/c2.png"),e.game.load.image("p1",d.img),e.game.load.image("p2",g.img)},this.create=function(){e.game.state.start("create")}}},{key:"create",value:function(){var e=this;this.create=function(){e.game.world.setBounds(0,0,1640,1230),e.game.physics.startSystem(Phaser.Physics.ARCADE),e.game.state.start("play")}}},{key:"play",value:function(){var i,n,a,o=this;this.create=function(){i=o.game.add.group(),i.ignoreChildInput=!0;for(var r in l)for(var u in l[r])0===l[r][u]&&i.add(new s(o.game,40*r,40*u));e=new c(o.game,40*d.x+7,40*d.y+7,"p1"),t=new c(o.game,40*g.x+7,40*g.y+7,"p2");var m={},f=!1;a=new h(o.game,60,60,"c1","c2"),o.game.camera.follow(e),o.game.input.maxPointers=1,o.game.input.onDown.add(function(e,t){f=!0,Object.assign(m,{x:e.clientX,y:e.clientY}),a.tap(e.clientX,e.clientY)}),o.game.input.onUp.add(function(t,i){f=!1,m={},e.body.velocity.x=0,e.body.velocity.y=0,a.cancel()}),o.game.input.addMoveCallback(function(t,i,n,o){if(this.game.debug.pointer(this.game.input.pointer1),!o&&f){var r=i-m.x,s=n-m.y;Math.abs(r)>Math.abs(s)?i>m.x?e.body.velocity.x=300:e.body.velocity.x=-300:n>m.y?e.body.velocity.y=300:e.body.velocity.y=-300,a.move(i,n)}},o.game.input.pointer1),n=setInterval(function(){f&&p.send({x:o.game.world.width-e.position.x-e.width,y:o.game.world.height-e.position.y-e.height})},100)},this.update=function(){o.game.physics.arcade.collide(e,i),o.game.physics.arcade.overlap(e,t,function(){clearInterval(n),this.game.state.start("over",!0,!1)},null,o)}}},{key:"render",value:function(e,i){this.game.add.tween(t).to({x:e,y:i},50,Phaser.Easing.Linear.None,!0,0,0)}},{key:"over",value:function(){this.create=function(){}}},{key:"receive",value:function(e){var t=JSON.parse(e.data);switch(t.code){case-1:break;case 1:console.log(t.user.nickname+"加入了游戏");break;case 0:this.render(t.operation.pos.x,t.operation.pos.y),console.log(t.operation.nickname+"移動至x:"+t.operation.pos.x+",y:"+t.operation.pos.y);break;case 200:l=t.maze,d=t.location,g=t.other,this.game.state.start("preload");break;case 403:console.log(t.msg)}}}]),n}();new u}()}],[0]);