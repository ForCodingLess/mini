webpackJsonp([0],[function(e,t,n){"use strict";function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(){var e,t,n=function(){function e(t){var n=this;o(this,e),this.handler=new WebSocket(config.WSS),this.id=t.id,this.openid=t.openid,this.headimg=t.headimg,this.nickname=t.nickname,this.handler.onopen=function(){console.log("连接已打开"),n.handler.send(JSON.stringify({id:t.id,type:"join",openid:t.openid,headimg:t.headimg,nickname:t.nickname}))},this.handler.onclose=function(){n.handler=null},this.handler.onmessage=function(e){t.onMessage(e)}}return r(e,[{key:"send",value:function(e){this.handler&&this.handler.send(JSON.stringify({id:this.id,type:"operate",pos:e,openid:this.openid,headimg:this.headimg,nickname:this.nickname}))}}]),e}(),s=function(e){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;o(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),l=e.rnd.between(1,4);return Phaser.Sprite.call(c,e,n,i,l),c.width=r,c.height=s,c.inputEnabled=!1,e.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.body.immovable=!0,c}return i(t,e),t}(Phaser.Sprite),c=function(e){function t(e,n,i,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:25,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:25;o(this,t);var l=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Phaser.Sprite.call(l,e,n,i,r),l.width=s,l.height=c,e.physics.arcade.enable(l),l.smoothed=!0,l.body.collideWorldBounds=!0,e.world.add(l),l}return i(t,e),t}(Phaser.Sprite),l=[],d={},h={},g=null,p=function(){function a(){var e=this;o(this,a),this.game=new Phaser.Game(375,620,Phaser.CANVAS,"container"),this.game.state.add("preload",this.preload),this.game.state.add("create",this.create),this.game.state.add("play",this.play),this.game.state.add("over",this.over);var t=~~(1e4*Math.random()).toString();g=new n({id:"123123",openid:t,headimg:"https://shp.qpic.cn/bizmp/CQ3lYf0saco7sJYbFrn3jvMxDJHjqZqiaqtGMtMNSqnW6DwcRD6qwGA/",nickname:"eee",onMessage:function(t){e.receive(t)}})}return r(a,[{key:"preload",value:function(){var e=this;this.preload=function(){e.game.load.crossOrigin="anonymous",e.game.stage.backgroundColor="#ffffff",e.game.load.image("1","./img/tree1.png"),e.game.load.image("2","./img/tree2.png"),e.game.load.image("3","./img/tree3.png"),e.game.load.image("4","./img/flower.png"),e.game.load.image("p1",d.img),e.game.load.image("p2",h.img)},this.create=function(){e.game.state.start("create")}}},{key:"create",value:function(){var e=this;this.create=function(){e.game.world.setBounds(0,0,1640,1230),e.game.physics.startSystem(Phaser.Physics.ARCADE),e.game.state.start("play")}}},{key:"play",value:function(){var n,a,i=this;this.create=function(){n=i.game.add.group(),n.ignoreChildInput=!0;for(var o in l)for(var r in l[o])0===l[o][r]&&n.add(new s(i.game,40*o,40*r));e=new c(i.game,40*d.x+7,40*d.y+7,"p1"),t=new c(i.game,40*h.x+7,40*h.y+7,"p2"),i.game.camera.follow(e);var p={},u=!1;i.game.input.maxPointers=1,i.game.input.onDown.add(function(e,t){u=!0,Object.assign(p,{x:e.clientX,y:e.clientY})}),i.game.input.onUp.add(function(t,n){u=!1,p={},e.body.velocity.x=0,e.body.velocity.y=0}),i.game.input.addMoveCallback(function(t,n,a,i){console.log(this.game.world.width),this.game.debug.pointer(this.game.input.pointer1),!i&&u&&(n>p.x?e.body.velocity.x=300:e.body.velocity.x=-300,a>p.y?e.body.velocity.y=300:e.body.velocity.y=-300)},i.game.input.pointer1),a=setInterval(function(){u&&g.send({x:i.game.world.width-e.position.x-e.width,y:i.game.world.height-e.position.y-e.height})},100)},this.update=function(){i.game.physics.arcade.collide(e,n),i.game.physics.arcade.overlap(e,t,function(){clearInterval(a),this.game.state.start("over",!0,!1)},null,i)}}},{key:"render",value:function(e,n){this.game.add.tween(t).to({x:e,y:n},0,Phaser.Easing.Linear.None,!0,0,0)}},{key:"over",value:function(){this.create=function(){}}},{key:"receive",value:function(e){var t=JSON.parse(e.data);switch(t.code){case-1:break;case 1:console.log(t.user.nickname+"加入了游戏");break;case 0:this.render(t.operation.pos.x,t.operation.pos.y),console.log(t.operation.nickname+"移動至x:"+t.operation.pos.x+",y:"+t.operation.pos.y);break;case 200:l=t.maze,d=t.location,h=t.other,this.game.state.start("preload");break;case 403:console.log(t.msg)}}}]),a}();new p}()}],[0]);